{"data":{"markdownRemark":{"html":"<p>在 Ant Design Pro 2.0 版本中除了很多功能性上的增强外，我们还将前端构建工具从 roadhog 升级到了 <a href=\"https://umijs.org/\">UmiJS</a>（简称 umi）。之所以说是升级而不是替换，是因为 umi 不仅仅是前端构建工具，它还包含了路由以及一套插件机制用于构建一个完整的 React 应用。</p>\n<p>所以如果你想要更好的在原有的项目中去添加 Ant Design Pro 2.0 的功能，将 2.0 的代码移植到你的项目中，你最好将你的项目从 roadhog 迁移到 umi。这边文档会指引你完成迁移工作，在此之前你可能需要先阅读 umi 的<a href=\"https://umijs.org/guide/\">文档</a>，使得先对 umi 有一个初步的认识，这对你的迁移工作会很有帮助。下面是以后大概的步骤，再往后会有更具体的说明。</p>\n<p>注：该迁移指南是基于当前最新的 v1 版本编写的，迁移指南对应的修改你可以在升级示例的 <a href=\"https://github.com/ant-design/ant-design-pro/commit/dc2118db78f9b2b7072051fea558e8d1386ce34c\">commit</a> 中查看。该 commit 只作为参考，不能直接应用在你的项目中，如果你的版本过老可能会有一些细节不一样，请结合具体情况迁移</p>\n<h2 id=\"迁移步骤概览\">迁移步骤概览<a href=\"#%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4%E6%A6%82%E8%A7%88\" aria-hidden class=\"anchor\">#</a></h2>\n<ul>\n<li>把 <code>package.json</code> roadhog 的依赖修改为 umi。</li>\n<li>拷贝 <code>.webpackrc.js</code> 中的配置到 <code>config/config.js</code> 中。</li>\n<li>修改 <code>src/routes</code> 目录名称为 pages，pages 是 umi 约定的目录。</li>\n<li>删除 <code>src/models/index.js</code>，在 umi 中 models 文件夹中的 dva model 会被自动挂载。</li>\n<li>重命名 <code>index.ejs</code> 为 <code>pages/document.ejs</code>，它是 umi 约定的文件。</li>\n<li>修改 <code>index.less</code> 为 <code>global.less</code> 和修改 <code>index.js</code> 为 <code>global.js</code>，他们也是 umi 约定的文件。</li>\n<li>在 <code>config/config.js</code> 中添加路由配置 routes。</li>\n<li>修改 <code>src/layouts/BasicLayout.js</code> 中的组件嵌套语法。</li>\n<li>修改 404 页面。</li>\n<li>修改权限路由 AuthorizedRoute 的逻辑。</li>\n<li>修改 mock。</li>\n<li>在 <code>.gitignore</code> 中添加 umi 相关文件。</li>\n<li>通过执行 <code>tnpm start</code> 和 <code>tnpm run lint</code> 修改可能出现的问题。</li>\n</ul>\n<h2 id=\"迁移步骤细节\">迁移步骤细节<a href=\"#%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4%E7%BB%86%E8%8A%82\" aria-hidden class=\"anchor\">#</a></h2>\n<h3 id=\"修改-roadhog-依赖为-umi\">修改 roadhog 依赖为 umi<a href=\"#%E4%BF%AE%E6%94%B9-roadhog-%E4%BE%9D%E8%B5%96%E4%B8%BA-umi\" aria-hidden class=\"anchor\">#</a></h3>\n<p>打开项目根目录下的 <code>package.json</code>，修改依赖为 umi：</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">\"dependencies\": {\n<span class=\"token deleted\">- \"dva\": \"^2.2.3\",</span>\n<span class=\"token deleted\">- \"dva-loading\": \"^2.0.3\",</span>\n<span class=\"token deleted\">- \"react-dom\": \"^16.4.1\",</span>\n<span class=\"token deleted\">- \"react-loadable\": \"^5.5.0\",</span>\n  ...\n},\n\"devDependencies\": {\n<span class=\"token inserted\">+ \"umi\": \"^2.0.0\",</span>\n<span class=\"token inserted\">+ \"umi-plugin-react\": \"^1.0.0\",</span>\n<span class=\"token deleted\">- \"roadhog\": \"^2.4.2\",</span>\n<span class=\"token deleted\">- \"roadhog-api-doc\": \"^1.1.2\",</span>\n  ...\n}</code></pre></div>\n<p>在 umi 中内置了 React，通过 umi-plugin-react 插件集内置了 antd 和 dva 等 React 技术栈常用的库。可以参考 <a href=\"https://umijs.org/plugin/umi-plugin-react.html\">umi-plugin-react 的文档</a>。</p>\n<p>另外 <code>package.json</code> 中的 scripts 也要做对应的修改：</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token deleted\">- \"start\": \"cross-env ESLINT=none roadhog dev\",</span>\n<span class=\"token deleted\">- \"start:no-proxy\": \"cross-env NO_PROXY=true ESLINT=none roadhog dev\",\t    </span>\n<span class=\"token deleted\">- \"build\": \"cross-env ESLINT=none roadhog build\",</span>\n<span class=\"token inserted\">+ \"start\": \"umi dev\",</span>\n<span class=\"token inserted\">+ \"start:no-mock\": \"cross-env MOCK=none umi dev\",</span>\n<span class=\"token inserted\">+ \"build\": \"umi build\",</span></code></pre></div>\n<p>修改完成之后记得不要忘记使用 <code>npm update</code> 将依赖更新到最新。</p>\n<h3 id=\"添加配置文件-configconfigjs\">添加配置文件 config/config.js<a href=\"#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-configconfigjs\" aria-hidden class=\"anchor\">#</a></h3>\n<p>umi 约定了 <code>.umirc.js</code> 和 <code>config/config.js</code> 为 umi 的配置文件（二选一），在 Ant Design Pro 中因为配置比较多，我们选择使用 <code>config/config.js</code>。</p>\n<p>你需要在项目中创建 <code>config/config.js</code>，该配置文件需要默认导出一个对象，里面包含了 umi 的全部配置。你可以先初始化为如下内容：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'umi-plugin-react'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      antd<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      dva<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        hmr<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>该配置会挂载 umi-plugin-react 插件集并打开 antd 和 dva 插件，使得你在项目中可以直接使用 antd 和 dva。</p>\n<p>添加 <code>config/config.js</code> 之后你可以将你项目下的 <code>.webpackrc.js</code> 中的配置也迁移到 <code>config/config.js</code> 中。 <code>.webpackrc.js</code> 是 af-webpack 的配置文件，umi 和 roadhog 都是依赖于它，所以你可以直接迁移过来。迁移过来之后就可以删除原有的 <code>.webpackrc.js</code> 和 <code>.babelrc.js</code> 文件了。</p>\n<p>不过需要注意的是 <code>.webpackrc.js</code> 中的如下配置是没有必要复制到 <code>config/config.js</code> 中的：</p>\n<ul>\n<li>entry: umi 会有默认的路由机制，需要删除该配置。</li>\n<li>extraBabelPlugins: umi-plugin-react 中会内置对 antd 的按需编译的支持，不再需要手动配置。</li>\n<li>env: env 下的 dva-hmr 插件不再需要，可以直接在 umi-plugin-react 配置中开启。</li>\n<li>alias: umi 中默认会添加 <code>@/</code> 的别名到 src 目录。</li>\n<li>html: umi 默认使用 <code>src/pages/document.ejs</code> 作为 html 模板。</li>\n</ul>\n<p>另外我们推荐将 <code>theme</code> 配置直接写到 <code>config/config.js</code> 中，然后就可以删除掉 <code>src/theme.js</code> 了。</p>\n<h3 id=\"修改-routes-为-pages\">修改 routes 为 pages<a href=\"#%E4%BF%AE%E6%94%B9-routes-%E4%B8%BA-pages\" aria-hidden class=\"anchor\">#</a></h3>\n<p>在 umi 中大量使用了约定和配置来高效的实现一些功能，其中 umi 就约定了 <code>src/pages</code> 目录为页面组件的存放目录。在 Ant Design Pro 1.0 中，我们的页面都存放在 <code>src/routes</code> 下面，所以我们只需要将 routes 重命名为 pages 即可。</p>\n<h3 id=\"删除-modelsindexjs\">删除 models/index.js<a href=\"#%E5%88%A0%E9%99%A4-modelsindexjs\" aria-hidden class=\"anchor\">#</a></h3>\n<p>在 umi 中，挂载了 dva 的插件之后 models 下的文件会被默认当做 dva model 引入，所以不再需要在 <code>models/index.js</code> 中来手动挂载 model，可以直接删除该文件。</p>\n<h3 id=\"修改-indexejs\">修改 index.ejs<a href=\"#%E4%BF%AE%E6%94%B9-indexejs\" aria-hidden class=\"anchor\">#</a></h3>\n<p>移动 <code>index.ejs</code> 到 <code>pages/document.ejs</code>，它是 umi 约定的文件。参考 <a href=\"https://umijs.org/guide/html-template.html\">œumi HTML 模板\n文档</a>。</p>\n<h3 id=\"修改-indexjs-和-indexless\">修改 index.js 和 index.less<a href=\"#%E4%BF%AE%E6%94%B9-indexjs-%E5%92%8C-indexless\" aria-hidden class=\"anchor\">#</a></h3>\n<p>重命名 <code>index.js</code> 为 <code>global.js</code>，重命名 <code>index.less</code> 为 <code>global.less</code>，他们会被 umi 自动挂载。可以参考 umi 的<a href=\"https://umijs.org/guide/app-structure.html\">目录约定</a>。另外因为 dva 插件会自动挂载 model 并默认添加 dva-loading 插件，所以 index.js 中的 dva 相关的内容可以被移除了。只需要保留类似下面这些初始化逻辑：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">'./polyfill'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'moment/locale/zh-cn'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'./rollbar'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>另外 <code>global.less</code> 中的 <code>:global</code> 标志也可以移除了，因为 <code>global.less</code> 中的样式默认就是全局的，这里要注意的是除了它其它都会默认使用 cssModule。</p>\n<h3 id=\"添加路由配置\">添加路由配置<a href=\"#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE\" aria-hidden class=\"anchor\">#</a></h3>\n<p>这一步是最重要的，umi 内置了路由的实现，提供了约定式和配置式两种路由方式。在 Ant Design Pro 中我们使用配置式路由的方式。你需要在 <code>config/config.js</code> 中添加配置项 <code>routes</code>，在这里我们基于 <code>/dashboard</code> 页面提供了一个样例，你需要按照你的项目具体做下迁移。我们推荐添加一个 <code>config/router.config.js</code> 的文件然后在 <code>config/config.js</code> 中引入它：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// config/router.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span>\n    component<span class=\"token punctuation\">:</span> <span class=\"token string\">'../layouts/BasicLayout'</span><span class=\"token punctuation\">,</span>\n    routes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token comment\">// dashboard</span>\n      <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> redirect<span class=\"token punctuation\">:</span> <span class=\"token string\">'/dashboard/analysis'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/dashboard'</span><span class=\"token punctuation\">,</span>\n        name<span class=\"token punctuation\">:</span> <span class=\"token string\">'dashboard'</span><span class=\"token punctuation\">,</span>\n        icon<span class=\"token punctuation\">:</span> <span class=\"token string\">'dashboard'</span><span class=\"token punctuation\">,</span>\n        routes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/dashboard/analysis'</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">'analysis'</span><span class=\"token punctuation\">,</span> component<span class=\"token punctuation\">:</span> <span class=\"token string\">'./Dashboard/Analysis'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/dashboard/monitor'</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">'monitor'</span><span class=\"token punctuation\">,</span> component<span class=\"token punctuation\">:</span> <span class=\"token string\">'./Dashboard/Monitor'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">'/dashboard/workplace'</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">'workplace'</span><span class=\"token punctuation\">,</span> component<span class=\"token punctuation\">:</span> <span class=\"token string\">'./Dashboard/Workplace'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>其中 component 是一个字符串，是相对于 <code>src/pages</code> 的路径，更多的路由配置你可以参考 v2 版本的路由配置，和 umi 的文档。另外原有的 1.0 版本的路由代码 <code>src/common/router.js</code> 和 <code>src/router.js</code> 也可以删除了。</p>\n<h3 id=\"修改布局组件\">修改布局组件<a href=\"#%E4%BF%AE%E6%94%B9%E5%B8%83%E5%B1%80%E7%BB%84%E4%BB%B6\" aria-hidden class=\"anchor\">#</a></h3>\n<p>因为不在使用 react-router@4 的组件式路由，所以你需要修改你的布局组件。把其中的 <code>&#x3C;Switch/></code> 组件部分修改为 <code>{this.props.children}</code>。</p>\n<h3 id=\"修改-404-页面\">修改 404 页面<a href=\"#%E4%BF%AE%E6%94%B9-404-%E9%A1%B5%E9%9D%A2\" aria-hidden class=\"anchor\">#</a></h3>\n<p>在 umi 中默认使用 <code>src/pages/404.js</code> 作为 404 页面，你需要将原来的 <code>src/routes/Exception/404.js</code> 迁移过去。</p>\n<h3 id=\"修改权限路由\">修改权限路由<a href=\"#%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90%E8%B7%AF%E7%94%B1\" aria-hidden class=\"anchor\">#</a></h3>\n<p>在 2.0 中，你可以直接使用 umi 提供的<a href=\"https://umijs.org/guide/router.html#%E6%9D%83%E9%99%90%E8%B7%AF%E7%94%B1\">权限路由</a>的方案。当然你也可以保留 1.0 中的方案继续使用。由于不是必要的，在本文中就不做具体说明了。</p>\n<h3 id=\"修改-mock-数据\">修改 mock 数据<a href=\"#%E4%BF%AE%E6%94%B9-mock-%E6%95%B0%E6%8D%AE\" aria-hidden class=\"anchor\">#</a></h3>\n<p>在 umi 中，默认会将 <code>mock/*.js</code> 的文件作为 mock 文件。所以可以将 mock 数据的 URL 信息迁移到 mock 文件中后删除 <code>.roadhogrc.mock.js</code> 文件，但是要注意的是直接写在 <code>.roadhogrc.mock.js</code> 中的 mock 数据需要迁移出来，比如可以新建 <code>mock/common.js</code> 来迁移这部分数据。</p>\n<p>更多说明可以参考 umi 的文档<a href=\"https://umijs.org/guide/mock-data.html\">Mock 数据</a>。</p>\n<h3 id=\"修改-gitignore\">修改 .gitignore<a href=\"#%E4%BF%AE%E6%94%B9-gitignore\" aria-hidden class=\"anchor\">#</a></h3>\n<p>使用 umi 后你需要将 umi 在开发和构建中的临时文件添加到 <code>.gitignore</code> 里面。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.umi\n.umi-production</code></pre></div>\n<h3 id=\"修改代码别名等细节\">修改代码别名等细节<a href=\"#%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E5%88%AB%E5%90%8D%E7%AD%89%E7%BB%86%E8%8A%82\" aria-hidden class=\"anchor\">#</a></h3>\n<p>以上的操作完成之后你就可以运行 <code>npm start</code> 启动你的项目了，你会看到报错，但是不要慌，按照报错信息一步一步修改即可。你可能需要修改的内容有：</p>\n<ul>\n<li>修改别名 <code>components/</code> 为 <code>@/components</code>。当然你也可以直接在 <code>config/config.js</code> 保留原有的别名。</li>\n<li>修改 <code>src/utils/request.js</code> 中和 dva 相关的部分。可以直接使用 <code>umi/router</code> 来做跳转。</li>\n<li><code>src/utils/request.js</code> 的 <code>/exception/400</code> 可以改为 <code>/400</code>。</li>\n<li>去掉 <code>BasicLayout</code> 中的 <code>const baseRedirect = this.getBaseRedirect();</code> 相关逻辑，跳转的逻辑可以通过 umi 的 routes 配置实现。</li>\n<li>修改 <code>BasicLayout</code> 中的 <code>getPageTitle</code> 和 <code>getBreadcrumbNameMap</code> 的相关逻辑，参考下面的代码实现。完整代码参考 v1 升级 <a href=\"https://github.com/ant-design/ant-design-pro/commit/dc2118db78f9b2b7072051fea558e8d1386ce34c\">commit</a>。</li>\n</ul>\n<p>注：<code>memoizeOne</code> 是 <code>memoize-one</code> npm 包提供的方法，你需要先 install memoize-one。<code>deepEqual</code> 是 <code>lodash.isequal</code> 包提供的，也需要安装相关依赖。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * 获取面包屑映射\n * @param {Object} menuData 菜单配置\n */</span>\n<span class=\"token keyword\">const</span> getBreadcrumbNameMap <span class=\"token operator\">=</span> <span class=\"token function\">memoizeOne</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">meun</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> routerMap <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">mergeMeunAndRouter</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">meunData</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    meunData<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">meunItem</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>meunItem<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">mergeMeunAndRouter</span><span class=\"token punctuation\">(</span>meunItem<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// Reduce memory usage</span>\n      routerMap<span class=\"token punctuation\">[</span>meunItem<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> meunItem<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">mergeMeunAndRouter</span><span class=\"token punctuation\">(</span>meun<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> routerMap<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> deepEqual<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>除了项目能够正常启动，你还应该再运行下 <code>tnpm run lint</code> 来解决下部分在迁移过程中产生的比较低级的问题。你可能需要处理的问题和方案如下：</p>\n<ul>\n<li><code>no-unused-vars</code> 错误，检查下没有问题就可以删除它了。</li>\n<li><code>react/destructuring-assignment</code> 错误，你可能需要修改类似 <code>this.props.children</code> 为 <code>const { children } = this.props</code> 之类的错误。</li>\n</ul>\n<p>另外我们推荐你迁移到 2.0 推荐的 lint 规则，让你的代码更优雅。</p>\n<h2 id=\"使用-20-中的新功能\">使用 2.0 中的新功能<a href=\"#%E4%BD%BF%E7%94%A8-20-%E4%B8%AD%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BD\" aria-hidden class=\"anchor\">#</a></h2>\n<p>完成 roadhog 到 umi 的迁移后要使用 2.0 的新功能就会变得简单。2.0 中我们主要有如下的新特性添加：</p>\n<ul>\n<li>新增用户信息页面。</li>\n<li>支持国际化。</li>\n<li>支持风格切换。</li>\n</ul>\n<h3 id=\"新增用户信息页面\">新增用户信息页面<a href=\"#%E6%96%B0%E5%A2%9E%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E9%A1%B5%E9%9D%A2\" aria-hidden class=\"anchor\">#</a></h3>\n<p>你只需要将 v2 <code>pages</code> 目录下对应的代码 copy 到你的项目中并在 <code>config/config.js</code> 中修改 routes 配置即可。这部分相对来说比较简单，这里不做过多说明。另外除了新增的用户信息页面外，你也可以参考其他页面的更新去跳转你自己项目中的代码。</p>\n<h3 id=\"支持国际化\">支持国际化<a href=\"#%E6%94%AF%E6%8C%81%E5%9B%BD%E9%99%85%E5%8C%96\" aria-hidden class=\"anchor\">#</a></h3>\n<p>在 Ant Design Pro 2.0 中我们使用了 umi 的插件 <code>umi-plugin-locale</code> 来实现国际化。该插件也已经内置到了 <code>umi-plugin-react</code> 插件集中。你可以在该插件集的配置中添加 <code>locale</code> 配置来开启国际化。</p>\n<p>开启国际化插件之后你就可以在项目目录下添加 <code>locales</code> 文件夹，按照约定添加国际化资源文件后就可以通过在项目中使用 <code>umi/locale</code> 暴露的 API 来实现国际化了。</p>\n<p>更多关于 <code>umi-plugin-locale</code> 的配置可以插件它的<a href=\"https://umijs.org/plugin/umi-plugin-react.html#locale\">文档</a>。</p>\n<h3 id=\"支持风格切换\">支持风格切换<a href=\"#%E6%94%AF%E6%8C%81%E9%A3%8E%E6%A0%BC%E5%88%87%E6%8D%A2\" aria-hidden class=\"anchor\">#</a></h3>\n<p>Ant Design Pro 使用了 less + cssModule 作为样式的解决方案，你可以通过配置 less 编译时的 lessVars 来就该主题样式配置，在 umi 中内置了该功能，你可以在配置文件中配置 <code>theme</code> 来实现。参考 umi 的<a href=\"https://umijs.org/config/#theme\">配置文档</a>。</p>\n<p>但是 v2 版本支持的导航布局方式等的调整主要是代码的业务逻辑的升级，你可以参考 v2 代码中的 <code>src/layouts/BasicLayout.js</code> 的代码做调整。</p>\n<p>对于在线的主题切换，因为 less 是在构建时编译的，要想实现在切换，需要支持 less 在在线编译等问题。为了解决该问题，我们开发了 <code>ant-design-theme</code> 的 webpack 插件和 <code>merge-less</code> 插件一起实现了这样的功能。如果你有需要，你可以参考 v2 代码中的 <code>config/plugin.config.js</code> 和 <code>src/models/setting.js</code> 来添加对应代码。</p>\n<h3 id=\"更多\">更多<a href=\"#%E6%9B%B4%E5%A4%9A\" aria-hidden class=\"anchor\">#</a></h3>\n<p>更多请查看 Ant Design Pro 2.0 <a href=\"https://www.yuque.com/ant-design/ant-design-pro/ant_design_pro_2.0_is_out\">发布日志</a>。</p>","tableOfContents":"<ul>\n<li><a href=\"/docs/upgrade-v2-cn/#%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4%E6%A6%82%E8%A7%88\">迁移步骤概览</a></li>\n<li>\n<p><a href=\"/docs/upgrade-v2-cn/#%E8%BF%81%E7%A7%BB%E6%AD%A5%E9%AA%A4%E7%BB%86%E8%8A%82\">迁移步骤细节</a></p>\n<ul>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9-roadhog-%E4%BE%9D%E8%B5%96%E4%B8%BA-umi\">修改 roadhog 依赖为 umi</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-configconfigjs\">添加配置文件 config/config.js</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9-routes-%E4%B8%BA-pages\">修改 routes 为 pages</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E5%88%A0%E9%99%A4-modelsindexjs\">删除 models/index.js</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9-indexejs\">修改 index.ejs</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9-indexjs-%E5%92%8C-indexless\">修改 index.js 和 index.less</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE\">添加路由配置</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9%E5%B8%83%E5%B1%80%E7%BB%84%E4%BB%B6\">修改布局组件</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9-404-%E9%A1%B5%E9%9D%A2\">修改 404 页面</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9%E6%9D%83%E9%99%90%E8%B7%AF%E7%94%B1\">修改权限路由</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9-mock-%E6%95%B0%E6%8D%AE\">修改 mock 数据</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9-gitignore\">修改 .gitignore</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E5%88%AB%E5%90%8D%E7%AD%89%E7%BB%86%E8%8A%82\">修改代码别名等细节</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/docs/upgrade-v2-cn/#%E4%BD%BF%E7%94%A8-20-%E4%B8%AD%E7%9A%84%E6%96%B0%E5%8A%9F%E8%83%BD\">使用 2.0 中的新功能</a></p>\n<ul>\n<li><a href=\"/docs/upgrade-v2-cn/#%E6%96%B0%E5%A2%9E%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E9%A1%B5%E9%9D%A2\">新增用户信息页面</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E6%94%AF%E6%8C%81%E5%9B%BD%E9%99%85%E5%8C%96\">支持国际化</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E6%94%AF%E6%8C%81%E9%A3%8E%E6%A0%BC%E5%88%87%E6%8D%A2\">支持风格切换</a></li>\n<li><a href=\"/docs/upgrade-v2-cn/#%E6%9B%B4%E5%A4%9A\">更多</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":{"zh_CN":"升级到 2.0 版本","en_US":"升级到 2.0 版本"},"order":2,"type":"入门"},"fields":{"path":"/docs/upgrade-v2.zh-CN.md","slug":"/docs/upgrade-v2-cn"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":{"zh_CN":"使用 TypeScript","en_US":"使用 TypeScript"},"order":7,"type":"进阶"},"fields":{"slug":"/docs/uset-typescript-cn","path":"/docs/uset-typescript.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Use TypeScript","en_US":"Use TypeScript"},"order":7,"type":"Advanced"},"fields":{"slug":"/docs/uset-typescript","path":"/docs/uset-typescript.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"独立使用 Pro 组件","en_US":"独立使用 Pro 组件"},"order":16,"type":"进阶"},"fields":{"slug":"/docs/use-components-alone-cn","path":"/docs/use-components-alone.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Use Pro Components Alone","en_US":"Use Pro Components Alone"},"order":16,"type":"Advanced"},"fields":{"slug":"/docs/use-components-alone","path":"/docs/use-components-alone.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"升级到 2.0 版本","en_US":"升级到 2.0 版本"},"order":2,"type":"入门"},"fields":{"slug":"/docs/upgrade-v2-cn","path":"/docs/upgrade-v2.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Upgrade to V2","en_US":"Upgrade to V2"},"order":2,"type":"Introduction"},"fields":{"slug":"/docs/upgrade-v2","path":"/docs/upgrade-v2.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"UI 测试","en_US":"UI 测试"},"order":15,"type":"进阶"},"fields":{"slug":"/docs/ui-test-cn","path":"/docs/ui-test.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"UI Test","en_US":"UI Test"},"order":15,"type":"Advanced"},"fields":{"slug":"/docs/ui-test","path":"/docs/ui-test.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"更换主题","en_US":"更换主题"},"order":14,"type":"进阶"},"fields":{"slug":"/docs/theme-cn","path":"/docs/theme.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Theme","en_US":"Theme"},"order":14,"type":"Advanced"},"fields":{"slug":"/docs/theme","path":"/docs/theme.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"样式","en_US":"样式"},"order":6,"type":"入门"},"fields":{"slug":"/docs/style-cn","path":"/docs/style.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Style","en_US":"Style"},"order":6,"type":"Introduction"},"fields":{"slug":"/docs/style","path":"/docs/style.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"和服务端进行交互","en_US":"和服务端进行交互"},"order":7,"type":"入门"},"fields":{"slug":"/docs/server-cn","path":"/docs/server.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Communicate with Server","en_US":"Communicate with Server"},"order":7,"type":"Introduction"},"fields":{"slug":"/docs/server","path":"/docs/server.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"路由和菜单","en_US":"路由和菜单"},"order":3,"type":"入门"},"fields":{"slug":"/docs/router-and-nav-cn","path":"/docs/router-and-nav.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Router and Nav","en_US":"Router and Nav"},"order":3,"type":"Introduction"},"fields":{"slug":"/docs/router-and-nav","path":"/docs/router-and-nav.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"设计资源","en_US":"设计资源"},"order":23,"type":"其他"},"fields":{"slug":"/docs/resource-cn","path":"/docs/resource.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Design Kit","en_US":"Design Kit"},"order":23,"type":"Other"},"fields":{"slug":"/docs/resource","path":"/docs/resource.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"新增页面","en_US":"新增页面"},"order":4,"type":"入门"},"fields":{"slug":"/docs/new-page-cn","path":"/docs/new-page.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"New Page","en_US":"New Page"},"order":4,"type":"Introduction"},"fields":{"slug":"/docs/new-page","path":"/docs/new-page.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"新增业务组件","en_US":"新增业务组件"},"order":5,"type":"入门"},"fields":{"slug":"/docs/new-component-cn","path":"/docs/new-component.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"New Component","en_US":"New Component"},"order":5,"type":"Introduction"},"fields":{"slug":"/docs/new-component","path":"/docs/new-component.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Mock 和联调","en_US":"Mock 和联调"},"order":13,"type":"进阶"},"fields":{"slug":"/docs/mock-api-cn","path":"/docs/mock-api.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Mock Data","en_US":"Mock Data"},"order":13,"type":"Advanced"},"fields":{"slug":"/docs/mock-api","path":"/docs/mock-api.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"布局","en_US":"布局"},"order":3,"type":"入门"},"fields":{"slug":"/docs/layout-cn","path":"/docs/layout.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Layout","en_US":"Layout"},"order":3,"type":"Introduction"},"fields":{"slug":"/docs/layout","path":"/docs/layout.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"引入外部模块","en_US":"引入外部模块"},"order":8,"type":"入门"},"fields":{"slug":"/docs/import-cn","path":"/docs/import.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Import Module","en_US":"Import Module"},"order":8,"type":"Introduction"},"fields":{"slug":"/docs/import","path":"/docs/import.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"国际化","en_US":"国际化"},"order":13,"type":"进阶"},"fields":{"slug":"/docs/i18n-cn","path":"/docs/i18n.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"i18n","en_US":"i18n"},"order":13,"type":"Advanced"},"fields":{"slug":"/docs/i18n","path":"/docs/i18n.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"图表","en_US":"图表"},"order":11,"type":"进阶"},"fields":{"slug":"/docs/graph-cn","path":"/docs/graph.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Charts","en_US":"Charts"},"order":11,"type":"Advanced"},"fields":{"slug":"/docs/graph","path":"/docs/graph.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"开始使用","en_US":"开始使用"},"order":0,"type":"入门"},"fields":{"slug":"/docs/getting-started-cn","path":"/docs/getting-started.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Getting Started","en_US":"Getting Started"},"order":0,"type":"Introduction"},"fields":{"slug":"/docs/getting-started","path":"/docs/getting-started.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"开始使用（蚂蚁金服用户）","en_US":"开始使用（蚂蚁金服用户）"},"order":1,"type":"入门"},"fields":{"slug":"/docs/getting-start-inner-cn","path":"/docs/getting-start-inner.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Getting Started (Ant Financial User)","en_US":"Getting Started (Ant Financial User)"},"order":1,"type":"Introduction"},"fields":{"slug":"/docs/getting-start-inner","path":"/docs/getting-start-inner.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"常见问题","en_US":"常见问题"},"order":22,"type":"其他"},"fields":{"slug":"/docs/faq-cn","path":"/docs/faq.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"FAQ","en_US":"FAQ"},"order":22,"type":"Other"},"fields":{"slug":"/docs/faq","path":"/docs/faq.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"错误处理","en_US":"错误处理"},"order":17,"type":"进阶"},"fields":{"slug":"/docs/error-handle-cn","path":"/docs/error-handle.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Error Handle","en_US":"Error Handle"},"order":17,"type":"Advanced"},"fields":{"slug":"/docs/error-handle","path":"/docs/error-handle.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"构建和发布","en_US":"构建和发布"},"order":8,"type":"入门"},"fields":{"slug":"/docs/deploy-cn","path":"/docs/deploy.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Build & Deploy","en_US":"Build & Deploy"},"order":8,"type":"Introduction"},"fields":{"slug":"/docs/deploy","path":"/docs/deploy.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"更新日志","en_US":"更新日志"},"order":21,"type":"其他"},"fields":{"slug":"/docs/changelog-cn","path":"/docs/changelog.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Changelog","en_US":"Changelog"},"order":21,"type":"Other"},"fields":{"slug":"/docs/changelog","path":"/docs/changelog.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"业务图标","en_US":"业务图标"},"order":12,"type":"进阶"},"fields":{"slug":"/docs/biz-icon-cn","path":"/docs/biz-icon.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"BIZ Icon","en_US":"BIZ Icon"},"order":12,"type":"Advanced"},"fields":{"slug":"/docs/biz-icon","path":"/docs/biz-icon.en-US.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"权限管理","en_US":"权限管理"},"order":24,"type":"进阶"},"fields":{"slug":"/docs/authority-management-cn","path":"/docs/authority-management.zh-CN.md"}}},{"node":{"frontmatter":{"title":{"zh_CN":"Authority Management","en_US":"Authority Management"},"order":24,"type":"Advanced"},"fields":{"slug":"/docs/authority-management","path":"/docs/authority-management.en-US.md"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/docs/upgrade-v2-cn","demo":"/upgrade-v2/demo/"}}