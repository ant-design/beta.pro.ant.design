{"componentChunkName":"component---src-templates-docs-tsx","path":"/config/runtime-api-cn","result":{"data":{"markdownRemark":{"html":"<p>在构建时是无法使用 dom 的，所以有些配置可能需要运行时来配置，一般而言我们都是在 <code>src/app.tsx</code> 中管理运行时配置。</p>\n<h2 id=\"getinitialstate\" style=\"position:relative;\"><a href=\"#getinitialstate\" aria-label=\"getinitialstate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"http://localhost:8000/docs/simple-model-cn\">getInitialState</a></h2>\n<p><code>getInitialState</code> 用于获取初始化数据，初始化数据使用 <code>useModel</code> 在各个组件中使用，在请求中 <code>getInitialState</code> 会堵塞页面加载。</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">/**\n * @see  https://umijs.org/zh-CN/plugins/plugin-initial-state\n * */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getInitialState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span>\n  currentUser<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token constant\">API</span><span class=\"token punctuation\">.</span>CurrentUser<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 如果是登录页面，不执行</span>\n  <span class=\"token keyword\">const</span> currentUser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchUserInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    currentUser<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"initialstateconfig\" style=\"position:relative;\"><a href=\"#initialstateconfig\" aria-label=\"initialstateconfig permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>initialStateConfig</h2>\n<p><code>initialStateConfig</code> 是 <code>getInitialState</code> 的补充配置，<code>getInitialState</code> 支持异步的设置，在初始化没有完成之前我们展示了一个 loading，<code>initialStateConfig</code> 可以配置这个 loading。</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">/** 获取用户信息比较慢的时候会展示一个 loading */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> initialStateConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  loading<span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PageLoading</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"request\" style=\"position:relative;\"><a href=\"#request\" aria-label=\"request permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"http://localhost:8000/docs/request-cn\">request</a></h2>\n<p><code>request</code> 用于配置全局的网络请求，你可以在这里做拦截器，全局错误处理，鉴权的配置。</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> request<span class=\"token operator\">:</span> RequestConfig <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">errorHandler</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token operator\">:</span> ResponseError</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> messages <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">getIntl</span><span class=\"token punctuation\">(</span><span class=\"token function\">getLocale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> response <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> error<span class=\"token punctuation\">;</span>\n    notification<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      description<span class=\"token operator\">:</span> <span class=\"token string\">'您的网络发生异常，无法连接服务器'</span><span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token string\">'网络异常'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">throw</span> error<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"layout\" style=\"position:relative;\"><a href=\"#layout\" aria-label=\"layout permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a><a href=\"https://procomponents.ant.design/components/layout\">layout</a></h2>\n<p>在构建时是无法使用 dom 的，所以有些配置可能需要运行时来配置，我们可以在<code>src/app.tsx</code> 中 export 一个 <code>layout</code> 来进行配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> RunTimeLayoutConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'umi'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BasicLayoutProps<span class=\"token punctuation\">,</span> Settings <span class=\"token keyword\">as</span> LayoutSettings <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@ant-design/pro-layout'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ProLayout 支持的api https://procomponents.ant.design/components/layout</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> layout<span class=\"token operator\">:</span> <span class=\"token function-variable function\">RunTimeLayoutConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> initialState <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">rightContentRender</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RightContent</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n    disableContentMargin<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    waterMarkProps<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      content<span class=\"token operator\">:</span> initialState<span class=\"token operator\">?.</span>currentUser<span class=\"token operator\">?.</span>name<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">footerRender</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Footer</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">onPageChange</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 自定义 403 页面</span>\n    <span class=\"token comment\">// unAccessible: &lt;div>unAccessible&lt;/div>,</span>\n    <span class=\"token operator\">...</span>initialState<span class=\"token operator\">?.</span>settings<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>layout 支持一个 function，可以与 <code>initialState</code> 结合使用，将动态数据放入 <code>initialState</code> 中每次 <code>initialState</code> 变化都会触发更新。</p>","tableOfContents":"<ul>\n<li><a href=\"/config/runtime-api-cn/#getinitialstate\">getInitialState</a></li>\n<li><a href=\"/config/runtime-api-cn/#initialstateconfig\">initialStateConfig</a></li>\n<li><a href=\"/config/runtime-api-cn/#request\">request</a></li>\n<li><a href=\"/config/runtime-api-cn/#layout\">layout</a></li>\n</ul>","frontmatter":{"title":"运行时配置","order":3,"type":null},"fields":{"path":"/config/runtime-api.zh-CN.md","slug":"/config/runtime-api-cn","modifiedTime":1620370023813,"avatarList":"[]"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"配置","order":1,"type":null,"time":null},"fields":{"slug":"/config/config-cn","path":"/config/config.zh-CN.md"}}},{"node":{"frontmatter":{"title":"API","order":2,"type":null,"time":null},"fields":{"slug":"/config/api-cn","path":"/config/api.zh-CN.md"}}},{"node":{"frontmatter":{"title":"运行时配置","order":3,"type":null,"time":null},"fields":{"slug":"/config/runtime-api-cn","path":"/config/runtime-api.zh-CN.md"}}}]}},"pageContext":{"slug":"/config/runtime-api-cn","type":"/config/","locale":"/-cn/"}},"staticQueryHashes":[]}