{"componentChunkName":"component---src-templates-docs-tsx","path":"/docs/environment-manage-cn","result":{"data":{"markdownRemark":{"html":"<h2 id=\"环境变量\" style=\"position:relative;\"><a href=\"#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\" aria-label=\"环境变量 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>环境变量</h2>\n<h3 id=\"默认环境变量\" style=\"position:relative;\"><a href=\"#%E9%BB%98%E8%AE%A4%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\" aria-label=\"默认环境变量 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>默认环境变量</h3>\n<p>Umi 中提供了大量的 <a href=\"https://umijs.org/zh/guide/env-variables.html#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE\">默认环境变量</a>，这些变量可以帮助我们管理一些脚手架功能。</p>\n<h3 id=\"设置环境变量\" style=\"position:relative;\"><a href=\"#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\" aria-label=\"设置环境变量 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>设置环境变量</h3>\n<p>在<code>package.json</code>内修改启动命令，以添加对应环境变量。</p>\n<p>示例代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/** 省略配置项 */</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/** 省略配置项 */</span>\n    <span class=\"token comment\">// 在start命令内添加UMI_ENV环境变量</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=dev UMI_ENV=dev umi dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start:dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=dev UMI_ENV=dev MOCK=none umi dev\"</span>\n    <span class=\"token comment\">/** 省略配置项 */</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/** 省略配置项 */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"多运行环境管理\" style=\"position:relative;\"><a href=\"#%E5%A4%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86\" aria-label=\"多运行环境管理 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>多运行环境管理</h2>\n<p>在开发中经常会有一些需求，根据应用运行的不同环境进行不同的逻辑处理。</p>\n<p>比如，<code>dev</code> 环境使用 <code>dev</code> 的对应的 Url，而线上则使用 <code>prod</code> 对应的 Url。 或者，在某些特定的环境需要打开只有在该环境下才会生效的功能。</p>\n<h3 id=\"获取当前运行环境名称\" style=\"position:relative;\"><a href=\"#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%90%8D%E7%A7%B0\" aria-label=\"获取当前运行环境名称 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>获取当前运行环境名称</h3>\n<p>在 Pro 的脚手架中有这样的一个环境变量 <code>REACT_APP_ENV</code>，该变量代表当前应用所处环境的具体名称。如 dev、test、pre、prod 等。</p>\n<p>如若需要在 <code>config</code> 外的非 node 环境文件中使用该环境变量，则需要在 <code>config</code> 导出默认 <code>defineConfig()</code> 时配置 <code>define{}</code>。</p>\n<p>示例代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// config/config.ts</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">REACT_APP_ENV</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">defineConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">{</span><span class=\"token comment\">/** 省略其他配置 */</span><span class=\"token punctuation\">}</span>\n  define<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">REACT_APP_ENV</span><span class=\"token operator\">:</span> <span class=\"token constant\">REACT_APP_ENV</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">{</span><span class=\"token comment\">/** 省略其他配置 */</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>使用该变量<a href=\"https://github.com/ant-design/ant-design-pro/blob/b005f2a465/src/components/GlobalHeader/RightContent.tsx\">示例代码</a>如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// src/components/RightContent/index.tsx</span>\n<span class=\"token comment\">/** 省略其他代码 */</span>\n<span class=\"token keyword\">const</span> GlobalHeaderRight<span class=\"token operator\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token constant\">FC</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/** 省略其他代码 */</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Space className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> 省略其他代码 <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> 在顶部右侧显示对应环境名称 <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token constant\">REACT_APP_ENV</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>Tag color<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>ENVTagColor<span class=\"token punctuation\">[</span><span class=\"token constant\">REACT_APP_ENV</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span><span class=\"token constant\">REACT_APP_ENV</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Tag<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Space<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"多环境多份配置文件\" style=\"position:relative;\"><a href=\"#%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%A4%9A%E4%BB%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\" aria-label=\"多环境多份配置文件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>多环境多份配置文件</h3>\n<p>Pro 脚手架默认使用 Umi 作为底层框架，在 Umi 内可通过指定 <code>UMI_ENV</code> 环境变量来<a href=\"https://umijs.org/zh-CN/docs/config#%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%A4%9A%E4%BB%BD%E9%85%8D%E7%BD%AE\">区分不同环境的配置文件</a>，<code>UMI_ENV</code> 需要在 <code>package.json</code> 内配置。</p>\n<p>示例配置如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">{</span><span class=\"token comment\">/** 省略... */</span><span class=\"token punctuation\">}</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"analyze\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env ANALYZE=1 umi build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"umi build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build:dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=dev UMI_ENV=dev umi build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build:test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=test UMI_ENV=test umi build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build:pre\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=pre UMI_ENV=pre umi build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build:prod\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=prod UMI_ENV=prod umi build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"deploy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run site &amp;&amp; npm run gh-pages\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run start:dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/** 省略... */</span><span class=\"token punctuation\">}</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=dev UMI_ENV=dev umi dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start:dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=dev UMI_ENV=dev MOCK=none umi dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start:no-mock\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=dev UMI_ENV=dev MOCK=none umi dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start:no-ui\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=dev UMI_ENV=dev UMI_UI=none umi dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start:pre\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=pre UMI_ENV=pre MOCK=none umi dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"start:test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env REACT_APP_ENV=test UMI_ENV=test MOCK=none umi dev\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span><span class=\"token comment\">/** 省略... */</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">{</span><span class=\"token comment\">/** 省略... */</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>当 <code>UMI_ENV</code> 为 <code>test</code> 时，则必须在 config 目录下配置 <code>config.test.ts</code> 文件来管理 <code>test</code> 环境下的不同变量，Umi 框架会在 deep merge 后形成最终配置。</p>\n<p>示例代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// config/config.test.ts test环境对应的配置文件</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> defineConfig <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'umi'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * 导出的多环境变量命名约定：一律大写且采用下划线分割单词\n * 注意：在添加变量后，需要在src/typing.d.ts内添加该变量的声明，否则在使用变量时IDE会报错。\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">defineConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  define<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">API_URL</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://api-test.xxx.com'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// API地址</span>\n    <span class=\"token constant\">API_SECRET_KEY</span><span class=\"token operator\">:</span> <span class=\"token string\">'XXXXXXXXXXXXXXXX'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// API调用密钥</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>变量使用示例：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// src/services/user.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> request <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'umi'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// 使用API密钥调用用户接口</span>\n  <span class=\"token keyword\">return</span> request<span class=\"token operator\">&lt;</span><span class=\"token constant\">API</span><span class=\"token punctuation\">.</span>CurrentUser<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token string\">'${API_URL}/api/users'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token constant\">API_SECRET_KEY</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>配置文件夹 config 下的结构：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ant-design-pro\n├── config\n│   ├── config.dev.ts\n│   ├── config.test.ts\n│   ├── config.pre.ts\n│   ├── config.prod.ts\n│   ├── config.ts\n│   ├── proxy.ts\n│   ├── routes.ts\n│   ├── defaultSettings.ts\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<h2 id=\"报错的处理方式\" style=\"position:relative;\"><a href=\"#%E6%8A%A5%E9%94%99%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F\" aria-label=\"报错的处理方式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>报错的处理方式</h2>\n<p>由于环境变量是直接使用，不会通过 window 对象的方式来使用，在 eslint 和 TypeScript 中都会报错。</p>\n<p>eslint 中可以通过增加 <a href=\"https://eslint.org/docs/user-guide/configuring#specifying-globals\"><code>globals</code></a> 的配置来处理报错。代码看起来是这样的</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"globals\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"page\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>在 TypeScript 可以在 <a href=\"https://github.com/ant-design/ant-design-pro/blob/33f562974d1c72e077652223bd816a57933fe242/src/typings.d.ts#L18\"><code>typings.d.ts</code></a> 中进行定义：</p>\n<p>示例代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// src/typings.d.ts</span>\n<span class=\"token comment\">// ... 代码省略</span>\ndeclare <span class=\"token keyword\">const</span> <span class=\"token constant\">REACT_APP_ENV</span><span class=\"token operator\">:</span> <span class=\"token string\">'test'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'dev'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'uat'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'prod'</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 以下变量声明对应config.[env].ts文件内define的变量</span>\ndeclare <span class=\"token keyword\">const</span> <span class=\"token constant\">API_URL</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\ndeclare <span class=\"token keyword\">const</span> <span class=\"token constant\">API_SECRET_KEY</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"变量使用的原理\" style=\"position:relative;\"><a href=\"#%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8E%9F%E7%90%86\" aria-label=\"变量使用的原理 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>变量使用的原理</h2>\n<p><a href=\"https://github.com/ant-design/ant-design-pro/blob/33f562974d1c72e077652223bd816a57933fe242/config/config.ts\">config</a> 是 node 环境，所以可以直接用 <code>process.env</code> 来直接拿到环境变量，但是非 node 环境的代码中，使用 <code>process.env</code> 可能只会获得 <code>NODE_ENV</code> 这个约定俗成的变量，别的变量 webpack 并不会自动注入。</p>\n<blockquote>\n<p>关于 <code>process.env</code> 和 <code>NODE_ENV</code> 请看<a href=\"https://webpack.docschina.org/guides/production/#%E6%8C%87%E5%AE%9A-mode\">这里</a>。</p>\n</blockquote>\n<p>这时候我们就需要使用 <a href=\"https://umijs.org/zh/config/#define\"><code>define</code></a>，他是通过 <a href=\"https://webpack.docschina.org/plugins/define-plugin/\"><code>define-plugin</code></a> 来实现的这个特性，在 <a href=\"https://github.com/ant-design/ant-design-pro/blob/33f562974d1c72e077652223bd816a57933fe242/config/config.ts#L65\"><code>config</code></a> 中将 node 的环境变量注入 define 配置中。</p>\n<p>使用时需要注意的是我们不需要通过 <code>window['key']</code> 的方式来使用它，而是直接使用。更具体的原理可以看一下<a href=\"https://webpack.docschina.org/plugins/define-plugin/\"><code>define-plugin</code></a>插件的实现。</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/docs/environment-manage-cn/#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\">环境变量</a></p>\n<ul>\n<li><a href=\"/docs/environment-manage-cn/#%E9%BB%98%E8%AE%A4%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\">默认环境变量</a></li>\n<li><a href=\"/docs/environment-manage-cn/#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F\">设置环境变量</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/docs/environment-manage-cn/#%E5%A4%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86\">多运行环境管理</a></p>\n<ul>\n<li><a href=\"/docs/environment-manage-cn/#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%90%8D%E7%A7%B0\">获取当前运行环境名称</a></li>\n<li><a href=\"/docs/environment-manage-cn/#%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%A4%9A%E4%BB%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\">多环境多份配置文件</a></li>\n</ul>\n</li>\n<li><a href=\"/docs/environment-manage-cn/#%E6%8A%A5%E9%94%99%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F\">报错的处理方式</a></li>\n<li><a href=\"/docs/environment-manage-cn/#%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8E%9F%E7%90%86\">变量使用的原理</a></li>\n</ul>","frontmatter":{"title":"环境变量","order":92,"type":"高级使用"},"fields":{"path":"/docs/environment-manage.zh-CN.md","slug":"/docs/environment-manage-cn","modifiedTime":1622775606343,"avatarList":"[]"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"文档总览","order":0,"type":"入门","time":null},"fields":{"slug":"/docs/overview-cn","path":"/docs/overview.zh-CN.md"}}},{"node":{"frontmatter":{"title":"开始使用","order":3,"type":"入门","time":null},"fields":{"slug":"/docs/getting-started-cn","path":"/docs/getting-started.zh-CN.md"}}},{"node":{"frontmatter":{"title":"新手需知","order":4,"type":"入门","time":null},"fields":{"slug":"/docs/introduction-cn","path":"/docs/introduction.zh-CN.md"}}},{"node":{"frontmatter":{"title":"启动项目","order":10,"type":"基础使用","time":null},"fields":{"slug":"/docs/development-cn","path":"/docs/development.zh-CN.md"}}},{"node":{"frontmatter":{"title":"文件夹结构","order":11,"type":"基础使用","time":null},"fields":{"slug":"/docs/folder-cn","path":"/docs/folder.zh-CN.md"}}},{"node":{"frontmatter":{"title":"标题和加载页","order":12,"type":"基础使用","time":null},"fields":{"slug":"/docs/title-landing-cn","path":"/docs/title-landing.zh-CN.md"}}},{"node":{"frontmatter":{"title":"新增页面","order":12,"type":"页面开发","time":null},"fields":{"slug":"/docs/new-page-cn","path":"/docs/new-page.zh-CN.md"}}},{"node":{"frontmatter":{"title":"图表","order":15,"type":"页面开发","time":null},"fields":{"slug":"/docs/graph-cn","path":"/docs/graph.zh-CN.md"}}},{"node":{"frontmatter":{"title":"布局","order":15,"type":"页面开发","time":null},"fields":{"slug":"/docs/layout-cn","path":"/docs/layout.zh-CN.md"}}},{"node":{"frontmatter":{"title":"简易数据流","order":19,"type":"数据管理","time":null},"fields":{"slug":"/docs/simple-model-cn","path":"/docs/simple-model.zh-CN.md"}}},{"node":{"frontmatter":{"title":"使用 css","order":20,"type":"样式和资源","time":null},"fields":{"slug":"/docs/css-cn","path":"/docs/css.zh-CN.md"}}},{"node":{"frontmatter":{"title":"CSS Modules","order":22,"type":"样式和资源","time":null},"fields":{"slug":"/docs/css-modules-cn","path":"/docs/css-modules.zh-CN.md"}}},{"node":{"frontmatter":{"title":"使用 less","order":23,"type":"样式和资源","time":null},"fields":{"slug":"/docs/less-cn","path":"/docs/less.zh-CN.md"}}},{"node":{"frontmatter":{"title":"添加图片，字体和文件","order":24,"type":"样式和资源","time":null},"fields":{"slug":"/docs/adding-images-fonts-and-files-cn","path":"/docs/adding-images-fonts-and-files.zh-CN.md"}}},{"node":{"frontmatter":{"title":"OpenAPI","order":30,"type":"后端集成","time":null},"fields":{"slug":"/docs/openapi-cn","path":"/docs/openapi.zh-CN.md"}}},{"node":{"frontmatter":{"title":"权限管理","order":30,"type":"数据管理","time":null},"fields":{"slug":"/docs/authority-management-cn","path":"/docs/authority-management.zh-CN.md"}}},{"node":{"frontmatter":{"title":"网络请求","order":31,"type":"后端集成","time":null},"fields":{"slug":"/docs/request-cn","path":"/docs/request.zh-CN.md"}}},{"node":{"frontmatter":{"title":"构建","order":31,"type":"构建和部署","time":null},"fields":{"slug":"/docs/build-cn","path":"/docs/build.zh-CN.md"}}},{"node":{"frontmatter":{"title":"Lint","order":31,"type":"质量","time":null},"fields":{"slug":"/docs/lint-cn","path":"/docs/lint.zh-CN.md"}}},{"node":{"frontmatter":{"title":"TypeScript","order":31,"type":"质量","time":null},"fields":{"slug":"/docs/type-script-cn","path":"/docs/typeScript.zh-CN.md"}}},{"node":{"frontmatter":{"title":"代理","order":32,"type":"后端集成","time":null},"fields":{"slug":"/docs/proxy-cn","path":"/docs/proxy.zh-CN.md"}}},{"node":{"frontmatter":{"title":"全局初始数据","order":32,"type":"数据管理","time":null},"fields":{"slug":"/docs/initial-state-cn","path":"/docs/initial-state.zh-CN.md"}}},{"node":{"frontmatter":{"title":"部署","order":32,"type":"构建和部署","time":null},"fields":{"slug":"/docs/deploy-cn","path":"/docs/deploy.zh-CN.md"}}},{"node":{"frontmatter":{"title":"调试","order":34,"type":"后端集成","time":null},"fields":{"slug":"/docs/debug-cn","path":"/docs/debug.zh-CN.md"}}},{"node":{"frontmatter":{"title":"菜单的高级用法","order":90,"type":"高级使用","time":null},"fields":{"slug":"/docs/advanced-menu-cn","path":"/docs/advanced-menu.zh-CN.md"}}},{"node":{"frontmatter":{"title":"常见问题","order":91,"type":"其它","time":null},"fields":{"slug":"/docs/faq-cn","path":"/docs/faq.zh-CN.md"}}},{"node":{"frontmatter":{"title":"Pro 资产的使用","order":91,"type":"高级使用","time":null},"fields":{"slug":"/docs/assets-cn","path":"/docs/assets.zh-CN.md"}}},{"node":{"frontmatter":{"title":"升级到 V5","order":92,"type":"其它","time":null},"fields":{"slug":"/docs/upgrade-v5-cn","path":"/docs/upgrade-v5.zh-CN.md"}}},{"node":{"frontmatter":{"title":"环境变量","order":92,"type":"高级使用","time":null},"fields":{"slug":"/docs/environment-manage-cn","path":"/docs/environment-manage.zh-CN.md"}}},{"node":{"frontmatter":{"title":"国际化","order":93,"type":"高级使用","time":null},"fields":{"slug":"/docs/i18n-cn","path":"/docs/i18n.zh-CN.md"}}},{"node":{"frontmatter":{"title":"设计资源","order":94,"type":"其它","time":null},"fields":{"slug":"/docs/resource-cn","path":"/docs/resource.zh-CN.md"}}},{"node":{"frontmatter":{"title":"测试","order":94,"type":"质量","time":null},"fields":{"slug":"/docs/test-cn","path":"/docs/test.zh-CN.md"}}}]}},"pageContext":{"slug":"/docs/environment-manage-cn","type":"/docs/","locale":"/-cn/"}},"staticQueryHashes":[]}