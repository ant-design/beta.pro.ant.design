{"componentChunkName":"component---src-templates-docs-tsx","path":"/blog/antd-4.0-cn","result":{"data":{"markdownRemark":{"html":"<p>antd@4 rc 发布已经有一段时间了（大概已经两周了），<a href=\"https://next.ant.design/index\">官网</a>  也已同步放出。最为一个酷爱尝鲜的人，当然要第一时间安装升级。在咨询了豆酱老师得到了 api 不会修改的承诺之后，我已经在自己的项目中迁移完成。第一时间享受到了的 antd@4 各种优势。</p>\n<h3 id=\"-升级点\" style=\"position:relative;\"><a href=\"#-%E5%8D%87%E7%BA%A7%E7%82%B9\" aria-label=\" 升级点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🚀 升级点</h3>\n<p>首先对我而言最大的改进在于性能，select ，table 和 tree 已经全面支持了虚拟滚动，作为了早早的使用了 rc-tree 来解决性能问题的人，antd@4 中提供自然是更好不过了，毕竟自己写样式和动态是非常复杂的。</p>\n<p>重写的 table 和 from 解决很多遗留的疑难杂症，具体可以查看豆酱老师的 antd@4 系列<a href=\"https://www.zhihu.com/people/smith-jiang/activities\">文章</a>，里面详细写了心路历程，在 form  中我们不需要使用 <code>getFieldDecorator</code> 和 <code>Form.create</code> 这两个方法。已 Pro 全区块为例，这两个方法分别出现了 87 和 22 次，在我自己的一个维护项目中找到了 142 个 <code>getFieldDecorator</code>，更不用说为了封装组件  <code>getFieldDecorator</code>   被当成 props 传来传去的造成的各种复杂性提升了。在 v4 中我们终于可以摆脱它了。</p>\n<p><img src=\"https://gw.alipayobjects.com/zos/antfincdn/xJ0Xhrkwvu/8EA666B0-76C7-47AC-B999-9EE15D043215.png#align=left&#x26;display=inline&#x26;height=399&#x26;name=&#x26;originHeight=1800&#x26;originWidth=2880&#x26;status=done&#x26;style=none&#x26;width=639\"></p>\n<p>瞧这都是删除的 diff</p>\n<p>Table 现在也可以自动的获得宽度，并且拥有更加优秀的固定到侧边，已 <a href=\"https://protable.ant.design/\">Pro-Table</a>为例，这里是 3.0 的 table。</p>\n<p><img src=\"https://gw.alipayobjects.com/zos/antfincdn/1nVM1VDeiz/a4ede9b8-1822-495d-9141-9c15107172a5.png\" alt=\"image.png\"></p>\n<p>在 4.0 中，不会发生高度错位的问题。</p>\n<p><img src=\"https://gw.alipayobjects.com/zos/antfincdn/fyP4ANU8Eb/ea9962b9-a317-48b6-a37a-47b6eef9664a.png\" alt=\"image.png\"></p>\n<h3 id=\"-迁移方法\" style=\"position:relative;\"><a href=\"#-%E8%BF%81%E7%A7%BB%E6%96%B9%E6%B3%95\" aria-label=\" 迁移方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🚚 迁移方法</h3>\n<p>antd@4 变得更加多才多艺，带来了巨量的提升，那我们怎么才能使用到这么棒的 4.0 呢 , 其实很简单，Pro 已经全部迁移了<a href=\"https://github.com/ant-design/pro-blocks/issues/145\">一把</a> 。官方贴心的为我们提供了 <code>codemod-v4</code>，使用起来也是非常简单。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 通过 npx 直接运行</span>\nnpx -p @ant-design/codemod-v4 antd4-codemod src\n\n<span class=\"token comment\"># 或者全局安装</span>\n<span class=\"token comment\"># 使用 npm</span>\n<span class=\"token function\">npm</span> i -g @ant-design/codemod-v4\n<span class=\"token comment\"># 或者使用 yarn</span>\n<span class=\"token function\">yarn</span> global <span class=\"token function\">add</span> @ant-design/codemod-v4\n\n<span class=\"token comment\"># 运行</span>\nantd4-codemod src</code></pre></div>\n<p>值得注意的是 如果项目中使用了 <code>&#x3C;Icon type={type} /></code>  会转化成 <code>LegacyIcon</code>，这里需要检查一下，如果你不是组件库你一定是不需要 <code>LegacyIcon</code>，迁移之后一定要删除它，不然会造成图标文件被全量打入，它可是有  540K 左右的大小。</p>\n<p>为了更加的语义化，icon 将从 i 标签修改为 span 标签，改完之后需要记得去查看一下有没有类似 <code>i{}</code>，<code>i.anticon</code> 等用法，如果有可以修改为 <code>span{}</code>, <code>span.antion</code> 来保证迁移完成的样式问题。</p>\n<p>另外由于 form 不兼容，codemod 不会自动帮你迁移到新的写法， 但是迁移到兼容包 <code>@ant-design/compatible</code> 方便在和新版本一起使用，而不用完全迁移。兼容包中 <code>ant-from</code> 类名将会更新为 <code>ant-legacy-form</code> ，如果你修改了 form 的默认样式记得检查一下，并且修改它。</p>\n<p>如果碰到表单无法撑开的问题可以加入下面的代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">:global</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">.ant-legacy-form-item .ant-legacy-form-item-control-wrapper</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"-pro-中使用\" style=\"position:relative;\"><a href=\"#-pro-%E4%B8%AD%E4%BD%BF%E7%94%A8\" aria-label=\" pro 中使用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💎 Pro 中使用</h3>\n<p>Pro 在第一时间也迁移了 antd@4 ，我们只需要在 create umi 中选择 ant-design-pro，即可获得最新的 4.0 分支代码。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">❯❯❯ create-umi\n? Select the boilerplate <span class=\"token builtin class-name\">type</span> ant-design-pro\n? 🤓 Which language <span class=\"token keyword\">do</span> you want to use? TypeScript\n? 🦄 Want to use better and faster antd? Yes\n<span class=\"token operator\">></span>\n<span class=\"token operator\">></span> 使用 antd <span class=\"token number\">4.0</span> 可能会有一些兼容性问题，阅读下面的文档了解具体的改动\n<span class=\"token operator\">></span> There may be some compatibility issues when using antd <span class=\"token number\">4.0</span>. Read the following documents <span class=\"token keyword\">for</span> specific changes\n<span class=\"token operator\">></span> https://next.ant.design/docs/react/migration-v4-cn\n<span class=\"token operator\">></span></code></pre></div>\n<p>如果你想获得迁移到新的版本，可以按照上面的文档描述实现，但是 Pro 中支持通过设置 icon 配置菜单图标，在 4.0 中将无法得到支持，所以我们提供了相应的<a href=\"https://github.com/umijs/umi-plugin-antd-icon-config\">插件</a>来保留此功能。</p>\n<p>使用方式如下 :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> umi-plugin-antd-icon-config -D</code></pre></div>\n<p>并且在 config.ts 中设置</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">'umi-plugin-antd-icon-config'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>无痛迁移 antd@4 就是这么简单。所有的官方区块也已经支持了 antd@4，请大家安心使用。</p>\n<blockquote>\n<p>由于 4.0 的 icon 有一些删改，如果发现图标消失，请在 antd 官网中寻找合适的进行替换。</p>\n</blockquote>\n<h3 id=\"-一个预告\" style=\"position:relative;\"><a href=\"#-%E4%B8%80%E4%B8%AA%E9%A2%84%E5%91%8A\" aria-label=\" 一个预告 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>✨ 一个预告</h3>\n<p>Pro 4 已经发布有一些时间了，在内外部的各种实践中我们期望可以探索出一套最佳实践，<a href=\"https://github.com/sorrycc/blog/issues/90\">sorrycc</a>  的文章中做了很深的思考。接下来我们会发布我们的解决方案。敬请期待！</p>","tableOfContents":"<ul>\n<li><a href=\"/blog/antd-4.0-cn/#-%E5%8D%87%E7%BA%A7%E7%82%B9\">🚀 升级点</a></li>\n<li><a href=\"/blog/antd-4.0-cn/#-%E8%BF%81%E7%A7%BB%E6%96%B9%E6%B3%95\">🚚 迁移方法</a></li>\n<li><a href=\"/blog/antd-4.0-cn/#-pro-%E4%B8%AD%E4%BD%BF%E7%94%A8\">💎 Pro 中使用</a></li>\n<li><a href=\"/blog/antd-4.0-cn/#-%E4%B8%80%E4%B8%AA%E9%A2%84%E5%91%8A\">✨ 一个预告</a></li>\n</ul>","frontmatter":{"title":"迁移 antd@4 指南","order":6,"type":"Blog"},"fields":{"path":"/blog/antd-4.0.zh-CN.md","slug":"/blog/antd-4.0-cn","modifiedTime":1583161618054,"avatarList":"[{\"username\":\"chenshuai2144\",\"url\":\"https://avatars1.githubusercontent.com/u/8186664?s=40&v=4\"},{\"username\":\"juzhiyuan\",\"url\":\"https://avatars3.githubusercontent.com/u/2106987?s=40&v=4\"}]"}},"allMarkdownRemark":{"edges":[{"node":{"frontmatter":{"title":"黑色主题和动态切换","order":8,"type":"Blog","time":"2019-12-25T00:00:00.000Z"},"fields":{"slug":"/blog/dynamic-theme-cn","path":"/blog/dynamic-theme.zh-CN.md"}}},{"node":{"frontmatter":{"title":"Layout 的全新样式","order":8,"type":"Blog","time":"2020-04-21T00:00:00.000Z"},"fields":{"slug":"/blog/layout-new-style-cn","path":"/blog/layout-new-style.zh-CN.md"}}},{"node":{"frontmatter":{"title":"同源策略 跨域与代理","order":7,"type":"Blog","time":"2019-11-24T00:00:00.000Z"},"fields":{"slug":"/blog/proxy-cn","path":"/blog/proxy.zh-CN.md"}}},{"node":{"frontmatter":{"title":"前端最佳实践即将发布","order":7,"type":"Blog","time":"2020-02-29T00:00:00.000Z"},"fields":{"slug":"/blog/best-front0end-cn","path":"/blog/best-front0end.zh-CN.md"}}},{"node":{"frontmatter":{"title":"ProTable 快速搭建 CRUD 的利器","order":7,"type":"Blog","time":"2020-03-01T00:00:00.000Z"},"fields":{"slug":"/blog/protable-cn","path":"/blog/protable.zh-CN.md"}}},{"node":{"frontmatter":{"title":"我们是如何部署开源项目的?","order":6,"type":"Blog","time":"2019-11-02T00:00:00.000Z"},"fields":{"slug":"/blog/deploy-pro-cn","path":"/blog/deploy-pro.zh-CN.md"}}},{"node":{"frontmatter":{"title":"迁移 antd@4 指南","order":6,"type":"Blog","time":"2020-01-16T00:00:00.000Z"},"fields":{"slug":"/blog/antd-4.0-cn","path":"/blog/antd-4.0.zh-CN.md"}}},{"node":{"frontmatter":{"title":"Block 新升级","order":5,"type":"Blog","time":"2019-06-28T00:00:00.000Z"},"fields":{"slug":"/blog/better-block-cn","path":"/blog/better-block.zh-CN.md"}}},{"node":{"frontmatter":{"title":"在线更换主题","order":1,"type":"Blog","time":"2019-05-07T00:00:00.000Z"},"fields":{"slug":"/blog/change-theme-cn","path":"/blog/change-theme.zh-CN.md"}}},{"node":{"frontmatter":{"title":"Pro 的 Layout 组件","order":1,"type":"Blog","time":"2019-05-08T00:00:00.000Z"},"fields":{"slug":"/blog/new-pro-use-cn","path":"/blog/new-pro-use.zh-CN.md"}}},{"node":{"frontmatter":{"title":"一起来用 eslint 吧","order":1,"type":"Blog","time":"2019-06-21T00:00:00.000Z"},"fields":{"slug":"/blog/use-eslint-typescript-cn","path":"/blog/use-eslint-typescript.zh-CN.md"}}}]}},"pageContext":{"slug":"/blog/antd-4.0-cn","type":"/blog/","locale":"/-cn/"}},"staticQueryHashes":[]}